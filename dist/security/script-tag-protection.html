<!DOCTYPE html>
<html>
<head>
  <title>About DWR's JavaScript Security</title>
  <meta name='alias' content='/dwr/security/script-tag-protection'>
  <meta name='navTitle' content='JavaScript Security'>
  <link rel="stylesheet" type="text/css" href="../media/styles.css">
  <link rel='shortcut icon' type='image/x-icon' href='../favicon.ico'>
  <script type='text/javascript' src='../media/dojo.js'> </script>
  <script type='text/javascript' src='../media/menu.js'> </script>
</head>
<body>
<div id='header'><a href='../index.html'>Direct Web Remoting</a></div>
<div id=pagelinks>
<div class='navlinks'>[ 
<a href='../index.html' title='Easy Ajax for Java'>DWR</a> | 
 ]
<form method='GET' action='https://www.google.com/search' id='search-form'>
<span id='search'>
<input class='form-text' type='text' id='search-box' name='as_q' size='20' maxlength='255'>
<input type='hidden' name='as_sitesearch' value='directwebremoting.org'/>
<input class='form-submit' type='submit' value='Google'/>
</span>
</form>
</div>
<div id='breadcrumbs'><a href='../index.html'>DWR - Easy Ajax for JAVA</a> &#x00BB; <a href='../security/index.html'>Security</a> &#x00BB; <a href='script-tag-protection.html' class='currentLink'>JavaScript Security</a></div></div>
<div id='content'>

<h1>About DWR's JavaScript Security</h1>

<p>DWR offers protection from several JavaScript vulnerabilities out of the box:

<ul>
    <li><a href="#xss">DWR's Protection against XSS</a></li>
    <li><a href="#scriptTagHack">DWR's Protection against the &lt;script&gt; tag hack and CSRF</a></li>    
</ul>

</p>

<h2><a name="xss"></a>DWR's Protection against XSS</h2>
<p>All relevant functions in DWR's util.js automatically escape dangerous characters which could be used in an XSS attack.  You can read more about how our XSS protection works <a href="../documentation/browser/util/escapeHtml.html">in our client documentation.</a></p>

<h2><a name="scriptTagHack"></a>DWR's Protection against the &lt;script&gt; tag hack and CSRF</h2>

<p>There are 3 basic ways to protect any service that returns JSON or JavaScript against the &lt;script&gt; tag hack.  Some of these methods or more reliable than others but DWR uses a combination of all three out of the box.</p>

<ul>
<li>DWR Uses a Secret in the Request (provides protection from CSRF attacks)</li>
<li>DWR Forces pre-eval() Processing</li>
<li>DWR Forces POST requests</li>
</ul>

<h2>DWR Uses a Secret in the Request (provides protection from CSRF attacks)</h2>

<p>If you can only support one of these protection methods, this is the one to chose. Including a secret in the request allows the server to reject the request as invalid before any actions take place. It is common to include the secret in the URL, however this is a slightly vulnerable position for a secret since it is likely to turn up in web server log files and so on.</p>

<p>DWR uses a secret in the POST body to allow the server to deny forged requests. (This secret is randomly generated by an algorithm on the server, and the algorithm is <a href="../documentation/server/configuration/servlet/plugin.html">pluggable</a> - org.directwebremoting.extend.IdGenerator). The secret in the POST body is compared with a cookie in the request, and if they don't match the request is rejected as a potential CSRF attack.  Security comes from a CSRF attackers inability to assign this cookie.
 You can turn this protection off (to allow cross-domain requests for public data) by setting the <a href="../documentation/server/configuration/servlet/index.html">crossDomainSessionSecurity=false init-param</a> in web.xml.</p>

<h2>DWR Forces pre-eval() Processing</h2>

<p>Since &lt;script&gt; tag remoting does not allow you to process the JSON or JavaScript before it is eval()ed you can protect your JSON by forcing it to be manipulated before it is eval()ed. There are 3 ways to do this (DWR implements the first):</p>

<ol>
<li>Prefix the script with '<code>throw new Error("message");</code>'. This is the approach taken by DWR and it is a neat solution in that it allows you to explain what is wrong to users that get the message by mistake.
<br/>
It is potentially vulnerable to some browser allowing an attacker to redefine the Error or String constructors to prevent the throw from happening, however this does not work on any browser that I know of, and it's hard to see how it could happen.
<br/>
DWR uses this method. You can control it using the <a href="../documentation/server/configuration/servlet/index.html">allowScriptTagRemoting=true init-param</a> in web.xml. There is also an experimental feature 'scriptTagProtection' that allows you to set the prefix used.</li>
<li>Wrap the JSON in a comment. For example, <code>/* { 'data':'protected' } */</code>. When this is eval()ed, there will be no result, however if you have fetched the data using XHR or iframe, you can do some string manipulation before eval() to remove the leading /* and trailing */.
<br/>
There are 2 problems with this approach. The first is that it requires manipulation of both ends of the string (the others only require one). The other, more serious, is that if your content could contain '*/', then the comment will terminate early, potentially leaving executable code behind. There could be many innovative ways to exploit this weakness, and it would be a mistake to thing that you were safe based on a trivial analysis.</li>

<li>Prefix the script with '<code>while(1);</code>'. Since this is an infinite loop, it causes browsers to hang, and maybe give an error message. Either way the script does not get executed.
<br/>
There is a potential issue with this solution - that some browser may allow you to override the action of 'while', using something like this: '<code>function while() {}</code>'. None of the current browsers allow this though.
<br/>
Google use this method to protect data in GMail. '<code>while(1);</code>' is possibly better than '<code>while(true);</code>' in case there are any browsers that allow you to redefine truth.</li>
</ol>

<h2>DWR Forces POST Requests</h2>

<p>Since browsers use GET to process <code>&lt;script&gt;</code> tags, you can prevent <code>&lt;script&gt;</code> tags from working by denying GET requests for some JavaScript resource. This is the most common solution, however it is also perhaps the weakest.</p>

<p>Firstly XHR-POST doesn't work with older versions of Safari, so some support for GET is often useful.</p>

<p>More importantly future versions of Firefox are touted to include cross-domain XHR support. While we don't have exact knowledge of how this will happen, it would be foolish to base your security plans on this technique holding up.</p>

<p>Finally, we're working in an environment where new possibilities are popping up every day - betting your security on a system that works more by fluke than design isn't a great idea in my opinion.</p>

<p>By default DWR denies GET requests for belt and braces security, however this is customizable using the <a href="allowGetForSafariButMakeForgeryEasier.html">allowGetForSafariButMakeForgeryEasier=true init-param</a> in web.xml.</p>

</div>
<div class='menu'>
<ul id='nav'>
<li class='noChildren'><a href='../index.html'>Home</a></li>
<li class='hasChildren'><a href='../introduction/index.html'>Overview&nbsp;...</a><ul>
<li class='noChildren'><a href='../introduction/index.html'>Index</a></li>
<li class='noChildren'><a href='../introduction/getting-started.html'>Quick Start</a></li>
<li class='noChildren'><a href='../introduction/remoting_options.html'>Remoting Options</a></li>
<li class='noChildren'><a href='../introduction/scripting-dwr.html'>Scripting DWR</a></li>
<li class='noChildren'><a href='../introduction/tutorials.html'>Official Examples</a></li>
<li class='noChildren'><a href='../introduction/elsewhere.html'>Other Examples</a></li>
</ul>
</li>
<li class='hasChildren'><a href='../downloads/index.html'>Download&nbsp;...</a><ul>
<li class='noChildren'><a href='../downloads/index.html'>Index</a></li>
<li class='noChildren'><a href='../downloads/ciBuilds.html'>CI Builds</a></li>
<li class='hasChildren'><a href='../downloads/changelog/index.html'>Change Log&nbsp;...</a><ul>
<li class='noChildren'><a href='../downloads/changelog/index.html'>Index</a></li>
<li class='noChildren'><a href='../downloads/changelog/dwr30.html'>New in v3.0</a></li>
<li class='noChildren'><a href='../downloads/changelog/dwr20.html'>New in v2.0</a></li>
</ul>
</li>
<li class='hasChildren'><a href='../downloads/upgrading/index.html'>Upgrading DWR&nbsp;...</a><ul>
<li class='noChildren'><a href='../downloads/upgrading/index.html'>Index</a></li>
<li class='noChildren'><a href='../downloads/upgrading/dwr30.html'>Upgrading to Version 3.0</a></li>
<li class='noChildren'><a href='../downloads/upgrading/dwr20.html'>Upgrading to Version 2.0</a></li>
</ul>
</li>
</ul>
</li>
<li class='hasChildren'><a href='../documentation/index.html'>Documentation&nbsp;...</a><ul>
<li class='noChildren'><a href='../documentation/index.html'>Index</a></li>
<li class='hasChildren'><a href='../documentation/browser/index.html'>Client Side&nbsp;...</a><ul>
<li class='noChildren'><a href='../documentation/browser/index.html'>Index</a></li>
<li class='hasChildren'><a href='../documentation/browser/engine/index.html'>engine.js&nbsp;...</a><ul>
<li class='noChildren'><a href='../documentation/browser/engine/index.html'>Index</a></li>
<li class='noChildren'><a href='../documentation/browser/engine/batch.html'>Call Batching</a></li>
<li class='noChildren'><a href='../documentation/browser/engine/ordering.html'>Call Ordering</a></li>
<li class='noChildren'><a href='../documentation/browser/engine/hooks.html'>Remoting Hooks</a></li>
<li class='noChildren'><a href='../documentation/browser/engine/options.html'>Remoting Options</a></li>
<li class='noChildren'><a href='../documentation/browser/engine/errors.html'>Timeouts</a></li>
</ul>
</li>
<li class='hasChildren'><a href='../documentation/browser/util/index.html'>util.js&nbsp;...</a><ul>
<li class='noChildren'><a href='../documentation/browser/util/index.html'>Index</a></li>
<li class='noChildren'><a href='../documentation/browser/util/lists.html'>List Manipulation</a></li>
<li class='noChildren'><a href='../documentation/browser/util/$.html'>$()</a></li>
<li class='noChildren'><a href='../documentation/browser/util/tables.html'>Table Manipulation</a></li>
<li class='noChildren'><a href='../documentation/browser/util/addOptions.html'>addOptions</a></li>
<li class='noChildren'><a href='../documentation/browser/util/addRows.html'>addRows</a></li>
<li class='noChildren'><a href='../documentation/browser/util/byId.html'>byId()</a></li>
<li class='noChildren'><a href='../documentation/browser/util/escapeHtml.html'>escapeHtml</a></li>
<li class='noChildren'><a href='../documentation/browser/util/getText.html'>getText</a></li>
<li class='noChildren'><a href='../documentation/browser/util/getValue.html'>getValue</a></li>
<li class='noChildren'><a href='../documentation/browser/util/getValues.html'>getValues</a></li>
<li class='noChildren'><a href='../documentation/browser/util/onReturn.html'>onReturn</a></li>
<li class='noChildren'><a href='../documentation/browser/util/removeAllOptions.html'>removeAllOptions</a></li>
<li class='noChildren'><a href='../documentation/browser/util/removeAllRows.html'>removeAllRows</a></li>
<li class='noChildren'><a href='../documentation/browser/util/selectRange.html'>selectRange</a></li>
<li class='noChildren'><a href='../documentation/browser/util/setValue.html'>setValue</a></li>
<li class='noChildren'><a href='../documentation/browser/util/setValues.html'>setValues</a></li>
<li class='noChildren'><a href='../documentation/browser/util/toDescriptiveString.html'>toDescriptiveString</a></li>
<li class='noChildren'><a href='../documentation/browser/util/useLoadingMessage.html'>useLoadingMessage</a></li>
</ul>
</li>
<li class='noChildren'><a href='../documentation/browser/xdomain.html'>Cross-domain Support</a></li>
<li class='noChildren'><a href='../documentation/browser/errors.html'>Error Handling</a></li>
<li class='noChildren'><a href='../documentation/browser/extra-data.html'>Callbacks and Scoping</a></li>
<li class='noChildren'><a href='../documentation/browser/support.html'>Browser Support</a></li>
</ul>
</li>
<li class='hasChildren'><a href='../documentation/server/index.html'>Server Side&nbsp;...</a><ul>
<li class='noChildren'><a href='../documentation/server/index.html'>Index</a></li>
<li class='hasChildren'><a href='../documentation/server/configuration/index.html'>Configuration&nbsp;...</a><ul>
<li class='noChildren'><a href='../documentation/server/configuration/index.html'>Index</a></li>
<li class='hasChildren'><a href='../documentation/server/configuration/servlet/index.html'>WEB-INF Reference&nbsp;...</a><ul>
<li class='noChildren'><a href='../documentation/server/configuration/servlet/index.html'>Index</a></li>
<li class='noChildren'><a href='../documentation/server/configuration/servlet/multiconfig.html'>Multiple dwr.xml files</a></li>
<li class='noChildren'><a href='../documentation/server/configuration/servlet/plugin.html'>Plug-ins</a></li>
<li class='noChildren'><a href='../documentation/server/configuration/servlet/test.html'>Test Mode</a></li>
</ul>
</li>
<li class='hasChildren'><a href='../documentation/server/configuration/dwrxml/index.html'>dwr.xml&nbsp;...</a><ul>
<li class='noChildren'><a href='../documentation/server/configuration/dwrxml/index.html'>Index</a></li>
<li class='hasChildren'><a href='../documentation/server/configuration/dwrxml/converters/index.html'>Converters&nbsp;...</a><ul>
<li class='noChildren'><a href='../documentation/server/configuration/dwrxml/converters/index.html'>Index</a></li>
<li class='noChildren'><a href='../documentation/server/configuration/dwrxml/converters/array.html'>Arrays</a></li>
<li class='noChildren'><a href='../documentation/server/configuration/dwrxml/converters/bean.html'>Beans / Objects</a></li>
<li class='noChildren'><a href='../documentation/server/configuration/dwrxml/converters/collection.html'>Collections</a></li>
<li class='noChildren'><a href='../documentation/server/configuration/dwrxml/converters/dom.html'>DOM Objects</a></li>
<li class='noChildren'><a href='../documentation/server/configuration/dwrxml/converters/enum.html'>Enum</a></li>
<li class='noChildren'><a href='../documentation/server/configuration/dwrxml/converters/file.html'>Images and Binary Files</a></li>
</ul>
</li>
<li class='hasChildren'><a href='../documentation/server/configuration/dwrxml/creators/index.html'>Creators&nbsp;...</a><ul>
<li class='noChildren'><a href='../documentation/server/configuration/dwrxml/creators/index.html'>Index</a></li>
<li class='noChildren'><a href='../documentation/server/configuration/dwrxml/creators/new.html'>'New' Creator</a></li>
<li class='noChildren'><a href='../documentation/server/configuration/dwrxml/creators/scripted.html'>'Scripted' Creator</a></li>
<li class='noChildren'><a href='../documentation/server/configuration/dwrxml/creators/static.html'>'Static' Creator</a></li>
</ul>
</li>
<li class='noChildren'><a href='../documentation/server/configuration/dwrxml/filters.html'>Filters</a></li>
<li class='noChildren'><a href='../documentation/server/configuration/dwrxml/signatures.html'>Signatures</a></li>
</ul>
</li>
<li class='noChildren'><a href='../documentation/server/configuration/annotations.html'>Annotations</a></li>
<li class='noChildren'><a href='../documentation/server/configuration/fluent.html'>Fluent Configuration</a></li>
</ul>
</li>
<li class='hasChildren'><a href='../documentation/server/integration/index.html'>Integrating with&nbsp;...</a><ul>
<li class='noChildren'><a href='../documentation/server/integration/index.html'>Index</a></li>
<li class='noChildren'><a href='../documentation/server/integration/spring.html'>Spring</a></li>
<li class='noChildren'><a href='../documentation/server/integration/hibernate.html'>Hibernate</a></li>
<li class='noChildren'><a href='../documentation/server/integration/jsf.html'>JSF</a></li>
<li class='noChildren'><a href='../documentation/server/integration/guice.html'>Guice</a></li>
<li class='noChildren'><a href='../documentation/server/integration/struts.html'>Struts</a></li>
<li class='noChildren'><a href='../documentation/server/integration/jaxer.html'>Aptana Jaxer</a></li>
<li class='noChildren'><a href='../documentation/server/integration/pageflow.html'>Pageflow / Beehive</a></li>
</ul>
</li>
<li class='noChildren'><a href='../documentation/server/environment.html'>Supported Environments</a></li>
<li class='noChildren'><a href='../documentation/server/logging.html'>Logging</a></li>
<li class='noChildren'><a href='../documentation/server/javaapi.html'>Accessing Servlet Objects</a></li>
<li class='noChildren'><a href='../documentation/server/generic.html'>Reading from other URLs</a></li>
<li class='noChildren'><a href='../documentation/server/script_compression.html'>Script Compression</a></li>
</ul>
</li>
<li class='hasChildren'><a href='../documentation/reverse-ajax/index.html'>Reverse Ajax&nbsp;...</a><ul>
<li class='noChildren'><a href='../documentation/reverse-ajax/index.html'>Index</a></li>
<li class='noChildren'><a href='../documentation/reverse-ajax/getting-started.html'>Getting Started</a></li>
<li class='noChildren'><a href='../documentation/reverse-ajax/configuration.html'>Configuring</a></li>
<li class='noChildren'><a href='../documentation/reverse-ajax/retry.html'>Error/Retry Logic</a></li>
<li class='noChildren'><a href='../documentation/reverse-ajax/hints-and-tips.html'>Hints and Tips</a></li>
<li class='noChildren'><a href='../documentation/reverse-ajax/load-monitors.html'>Load Monitors</a></li>
<li class='noChildren'><a href='../documentation/reverse-ajax/threads.html'>Non-Web Threads</a></li>
</ul>
</li>
</ul>
</li>
<li class='hasChildren'><a href='../security/index.html'>Security&nbsp;...</a><ul>
<li class='noChildren'><a href='../security/index.html'>Index</a></li>
<li class='noChildren'><a href='script-tag-protection.html' class='currentLink'>JavaScript Security</a></li>
<li class='noChildren'><a href='../security/allowGetForSafariButMakeForgeryEasier.html'>Safari, GET and CSRF</a></li>
</ul>
</li>
<li class='hasChildren'><a href='../support/index.html'>Support&nbsp;...</a><ul>
<li class='noChildren'><a href='../support/index.html'>Index</a></li>
<li class='noChildren'><a href='../support/common_problems.html'>Common Problems</a></li>
<li class='noChildren'><a href='../support/faqs.html'>Common Questions</a></li>
</ul>
</li>
<li class='hasChildren'><a href='../development/index.html'>Development&nbsp;...</a><ul>
<li class='noChildren'><a href='../development/index.html'>Index</a></li>
<li class='hasChildren'><a href='../development/contributor/index.html'>Contributors&nbsp;...</a><ul>
<li class='noChildren'><a href='../development/contributor/index.html'>Index</a></li>
<li class='noChildren'><a href='../development/contributor/contract.html'>The Maintainer Contract</a></li>
</ul>
</li>
<li class='noChildren'><a href='../development/ccla.html'>CLA for Corporations</a></li>
<li class='noChildren'><a href='../development/icla.html'>CLA for Individuals</a></li>
</ul>
</li>
</ul></div>
</body>
</html>
